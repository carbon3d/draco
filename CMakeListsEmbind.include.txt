require_compiler_flag("--bind" YES)

require_compiler_flag("-s NO_FILESYSTEM=1" YES)
require_compiler_flag("-s EXPORTED_RUNTIME_METHODS=[]" YES)
require_compiler_flag("-s PRECISE_F32=1" YES)
require_compiler_flag("-s WASM=1" YES)
if (ENABLE_EXTRA_SPEED)
  require_compiler_flag("--llvm-lto 1" YES)  # potentially unsafe according to emscripten specs
endif ()  
require_compiler_flag("-s ALLOW_MEMORY_GROWTH=1" YES)
require_compiler_flag("-s MODULARIZE=1" YES)
require_compiler_flag("-s EXPORT_NAME='DracoEncoderEmbind'" YES)
#require_compiler_flag("-s ENVIRONMENT=\"web\"" YES)
require_compiler_flag("-s ENVIRONMENT=\"worker\"" YES)
require_compiler_flag("-s EXPORT_ES6=1" YES)
require_compiler_flag("--memory-init-file 0" YES)

require_compiler_flag("-s ASSERTIONS=1" YES)

 
# Uncomment to verify future proofing
#require_compiler_flag("-s STRICT=1" YES)
set(draco_embind_encoder_src
  ${draco_attributes_sources}
  ${draco_compression_attributes_dec_sources}
  ${draco_compression_attributes_enc_sources}
  ${draco_compression_attributes_pred_schemes_dec_sources}
  ${draco_compression_attributes_pred_schemes_enc_sources}
  ${draco_compression_bit_coders_sources}
  ${draco_compression_decode_sources}
  ${draco_compression_encode_sources}
  ${draco_compression_entropy_sources}
  ${draco_compression_mesh_traverser_sources}
  ${draco_compression_mesh_dec_sources}
  ${draco_compression_point_cloud_dec_sources}  
  ${draco_compression_mesh_enc_sources}
  ${draco_compression_point_cloud_enc_sources}
  ${draco_core_sources}
  ${draco_dec_config_sources}
  ${draco_enc_config_sources}
  ${draco_io_sources}
  ${draco_mesh_sources}
  ${draco_metadata_dec_sources}
  ${draco_metadata_enc_sources}
  ${draco_metadata_sources}
  ${draco_point_cloud_sources}
  ${draco_points_enc_sources}
  ${draco_version_sources})
add_executable(DracoEncoderEmbind "${draco_src_root}/javascript/emscripten/draco_embind_encoder.cc"
  ${draco_embind_encoder_src})
draco_enable_feature(FEATURE DRACO_ATTRIBUTE_INDICES_DEDUPLICATION_SUPPORTED
  TARGETS DracoEncoderEmbind)
draco_enable_feature(FEATURE DRACO_ATTRIBUTE_VALUES_DEDUPLICATION_SUPPORTED
   TARGETS DracoEncoderEmbind)
